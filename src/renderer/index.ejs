<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <!--
      Content-Security-Policy controls what resources the renderer can access.

      DO NOT CHANGE THIS WITHOUT A SERIOUS REASON

      Please uncomment the image creation arbitrary code execution in `evil.js`'s WebView when you
      make changes so we can double check it is still successfully blocked.

      default-src 'none' so things can't happen unless we allow them
      script-src-elem allows script tags but not in-line attribute scripts. That way, we can remove
        scripts we don't want using MutationObserver and not have to worry about in-line scripts
        'self' so scripts can be loaded from us
        papi-extension: so scripts can be loaded from installed extensions
        'unsafe-inline' because web view iframes use srcdoc right now, which inherits CSP from parent frames
          TODO: PLEASE FIX THIS - Move web views to be retrieved from the backend, and remove this. paranext-core#89
        TODO: change to script-src-elem so in-line attribute scripts like event handlers don't run? If this is actually more secure. paranext-core#89
      style-src allows them to use style/link tags and style attributes on tags
        'self' so styles can be loaded from us
        papi-extension: so styles can be loaded from installed extensions
        'unsafe-inline' because that's how our styles are currently loaded in by hot reloading
          TODO: PLEASE FIX THIS IN PRODUCTION. paranext-core#89
      frame-src 'self' so frame contents can be loaded from us
      object-src 'none' to prevent insecure object and embed until we have a reason to use them
      worker-src 'self' so web workers can be loaded from us
      manifest-src 'self' so we can load our manifest
        TODO: What exactly does this do?
      connect-src only communicate over the network as we allow
        'self' communicate with us
        https: communicate with secure networks
        ws: communicate with webSockets
          TODO: try to template the specific url from ClientNetworkConnector in. paranext-core#89
      img-src load images
        'self' so images can be loaded from us
        papi-extension: so images can be loaded from installed extensions
        https: so they can load images from us and over secure connections
      media-src load audio, video, etc
        'self' so media can be loaded from us
        papi-extension: so media can be loaded from installed extensions
        https: so media can be loaded over secure connections
      font-src load fonts
        'self' so fonts can be loaded from us
        papi-extension: so fonts can be loaded from installed extensions
        https: so fonts can be loaded over secure connections
      form-action 'self' lets the form submit to us
        TODO: not sure if this is needed. If we can attach handlers to forms, we might be able to remove this
      navigate-to 'none' prevents them from redirecting this iframe somewhere else
        WARNING: This is experimental and does not work as of July 2023! It is here for future
        compatibility in case they add support for it
    -->
    <meta
      http-equiv="Content-Security-Policy"
      content="
        default-src 'none';
        script-src-elem 'self' papi-extension: 'unsafe-inline';
        style-src 'self' papi-extension: 'unsafe-inline';
        frame-src 'self';
        object-src 'none';
        worker-src 'self';
        manifest-src 'self';
        connect-src 'self' https: ws:;
        img-src 'self' papi-extension: https:;
        media-src 'self' papi-extension: https:;
        font-src 'self' papi-extension: https:;
        form-action 'self';
        navigate-to 'none';"
    />
    <title>Platform.Bible</title>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
